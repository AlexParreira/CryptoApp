//
//  MarketDataModel.swift
//  CryptoApp
//
//  Created by Alexander Parreira on 30/09/23.
//

import Foundation

/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
 "data": {
 "active_cryptocurrencies": 10189,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 872,
 "total_market_cap": {
 "btc": 41437645.234557435,
 "eth": 668149429.8950673,
 "ltc": 16891476493.89351,
 "bch": 4746258857.653514,
 "bnb": 5201226369.573686,
 "eos": 1917360218913.7288,
 "xrp": 2166895780758.6997,
 "xlm": 9957706846052.941,
 "link": 136581586798.51768,
 "dot": 272427754694.21597,
 "yfi": 214052344.43652144,
 "usd": 1119032614361.0762,
 "aed": 4110251553852.805,
 "ars": 391683795678663.94,
 "aud": 1740874562031.0664,
 "bdt": 123641660659384.48,
 "bhd": 421883128842.42584,
 "bmd": 1119032614361.0762,
 "brl": 5631531631772.098,
 "cad": 1520821274547.4204,
 "chf": 1024533667176.1271,
 "clp": 997225914287872.6,
 "cny": 8162447695672.5625,
 "czk": 25848646262387.926,
 "dkk": 7892201319304.372,
 "eur": 1057653675463.3717,
 "gbp": 917465745666.672,
 "hkd": 8763368209584.473,
 "huf": 412285186109051.0,
 "idr": 1.7337563955711172e+16,
 "ils": 4259631217543.85,
 "inr": 93078391232649.12,
 "jpy": 167155513667578.25,
 "krw": 1513972794947530.8,
 "kwd": 345937742403.5831,
 "lkr": 363631426179456.0,
 "mmk": 2354973088243964.5,
 "mxn": 19492317206294.133,
 "myr": 5254137882578.827,
 "ngn": 872585176834257.4,
 "nok": 11948588238264.912,
 "nzd": 1866610185613.295,
 "php": 63393757119862.13,
 "pkr": 323815111061417.7,
 "pln": 4896398822224.22,
 "rub": 109665196207385.48,
 "sar": 4196962034041.811,
 "sek": 12219612342300.074,
 "sgd": 1528710454478.6655,
 "thb": 40824814166882.99,
 "try": 30676152960741.613,
 "twd": 36084549489210.12,
 "uah": 41416414258149.87,
 "vef": 112048735675.97458,
 "vnd": 2.7197325383529376e+16,
 "zar": 21175554874489.92,
 "xdr": 855248651340.8092,
 "xag": 50450063534.113754,
 "xau": 605385454.0431963,
 "bits": 41437645234557.44,
 "sats": 4143764523455743.5
 },
 "total_volume": {
 "btc": 1233410.9469287652,
 "eth": 19887781.179455604,
 "ltc": 502782720.8671426,
 "bch": 141274621.15307102,
 "bnb": 154816942.55002373,
 "eos": 57071126262.785194,
 "xrp": 64498669306.92831,
 "xlm": 296395814981.9413,
 "link": 4065414995.2928,
 "dot": 8108939901.991489,
 "yfi": 6371368.434410794,
 "usd": 33308530653.962193,
 "aed": 122343565433.22922,
 "ars": 11658651899499.848,
 "aud": 51817947904.2463,
 "bdt": 3680252024228.3555,
 "bhd": 12557549216.258312,
 "bmd": 33308530653.962193,
 "brl": 167625180516.0642,
 "cad": 45267958585.26731,
 "chf": 30495725165.82707,
 "clp": 29682897092278.395,
 "cny": 242959084296.13104,
 "czk": 769397080428.9377,
 "dkk": 234915074143.19943,
 "eur": 31481557747.59238,
 "gbp": 27308798261.386566,
 "hkd": 260845765257.3091,
 "huf": 12271861948839.281,
 "idr": 516060723407564.94,
 "ils": 126789921190.22618,
 "inr": 2770521973896.4727,
 "jpy": 4975462269394.416,
 "krw": 45064110377665.07,
 "kwd": 10296999166.365873,
 "lkr": 10823659963260.225,
 "mmk": 70096878582771.836,
 "mxn": 580197964608.3015,
 "myr": 156391878553.01553,
 "ngn": 25972907078648.094,
 "nok": 355655333453.4004,
 "nzd": 55560527717.05625,
 "php": 1886944915812.285,
 "pkr": 9638508667742.16,
 "pln": 145743607622.37375,
 "rub": 3264236004088.2954,
 "sar": 124924543548.01308,
 "sek": 363722493035.13617,
 "sgd": 45502783726.37773,
 "thb": 1215169742748.144,
 "try": 913090081670.1307,
 "twd": 1074073541173.7952,
 "uah": 1232778996957.5046,
 "vef": 3335183174.3812346,
 "vnd": 809541147073990.6,
 "zar": 630300323332.6849,
 "xdr": 25456877265.55689,
 "xag": 1501669804.932201,
 "xau": 18019581.99848694,
 "bits": 1233410946928.7651,
 "sats": 123341094692876.52
 },
 "market_cap_percentage": {
 "btc": 47.059667337798885,
 "eth": 17.991434417944685,
 "usdt": 7.438563510676952,
 "bnb": 2.9564821522840483,
 "xrp": 2.46108546291605,
 "usdc": 2.2427618405817564,
 "steth": 1.31575194581727,
 "ada": 0.7940097507822713,
 "sol": 0.789188636925692,
 "doge": 0.7855404164007744
 },
 "market_cap_change_percentage_24h_usd": 0.39905629614303795,
 "updated_at": 1696114534
 }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]?
    let marketCapChangePercentage24HUsd: Double?
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String{
        if let item = totalMarketCap?.first(where: {$0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume?.first(where: {$0.key == "usd"}){
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""

    }
    
    var btcDominance: String {
        if let item = marketCapPercentage?.first(where: { $0.key == "usd"}){
            return item.value.asPercentString()
        }
        return ""
    }
}
